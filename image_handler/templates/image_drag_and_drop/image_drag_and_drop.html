{% extends 'default_django_project/base.html' %}
{% load static %}
{% block extrastyle %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.7.2/dropzone.min.css"
          integrity="sha512-3g+prZHHfmnvE1HBLwUnVuunaPOob7dpksI7/v6UnF/rnKGwHf/GdEq9K7iEN7qTtW+S0iivTcGpeTBqqB04wA=="
          crossorigin="anonymous"/>
{% endblock %}
{% block side_navigation %}
    {% include 'base_site/side_navigation.html' %}
{% endblock %}
{% block content %}
    <div class="main-content">
        <div class="container">
            <div class="row">
                <div class="card">
                    <div class="card-header">
                        <h6>Drag And Drop Images</h6>
                    </div>
                    <div class="card-body">
                        <div id="dropzone">
                            <form id="dropZoneForm" class="dropzone needsclick dz-clickable" action="#" method="post"
                                  enctype="multipart/form-data">
                                {% csrf_token %}
                                <input type="hidden" name="abc" value="i am hidden value">
                                <div class="fallback">
                                    <input name="file" type="file" multiple/>
                                </div>
                            </form>
                            <input type="submit" id="submit-all" value="Upload" class="custom-button"
                                   style="float: right">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

{% endblock %}
{% block js %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.7.2/min/dropzone.min.js"
            integrity="sha512-9WciDs0XP20sojTJ9E7mChDXy6pcO0qHpwbEJID1YVavz2H6QBz5eLoDD8lseZOb2yGT8xDNIV7HIe1ZbuiDWg=="
            crossorigin="anonymous"></script>

    <script type="text/javascript">
    final_url = "http://127.0.0.1:8000/image_handler/image_drag_and_drop/upload/";
    Dropzone.options.dropZoneForm = {
        url: final_url,
        addRemoveLinks: true,
        method: "POST",
        params: 'file_upload',
        maxFilesize: 256 * 4 * 2,
        dictFileTooBig: "File is too big.",
        autoProcessQueue: false,
        acceptedFiles: '.png, .jpg,.gif,.bmp,.jpeg',
        uploadMultiple: true,
        dictDefaultMessage: "Drag and Drop files here to upload",
        parallelUploads: 10,
        maxFiles: 12,
        clickable: true,
        headers: {
            'Access-Control-Request-Headers':'authorization,cache-control,x-requested-with',
            'Access-Control-Allow-Origin':'*'
            // remove Cache-Control and X-Requested-With
            // to be sent along with the request
        },
        init: function () {
            mydropzone = this;

            $("#submit-all").click(function (evt) {
                evt.preventDefault();
                evt.stopPropagation();
                var paymentNotes = $("#paymentNotes").val();
                mydropzone.autoProcessQueue = true;
                mydropzone.processQueue();

            });
            mydropzone.on('sending', function (file, xhr, formData) {

                var notes = $("#paymentNotes").val();
                var outgoingManualPaymentID = $("#outgoingManualPaymentID").val();
                console.log('notes from sending' + notes);
                console.log('notes from sending' + notes);
                formData.append('paymentNotes', notes);
                formData.append('outgoingManualPaymentID', outgoingManualPaymentID);
            });
        },
        success: function f(response) {
            console.log('response' + response);
            $('.dz-remove').hide();
        },
    };

</script>
{% endblock %}